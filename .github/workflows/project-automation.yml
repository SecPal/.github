# SPDX-FileCopyrightText: 2025 SecPal
# SPDX-License-Identifier: CC0-1.0

name: Add Issues to Project

on:
  issues:
    types:
      - opened
      - reopened
      - labeled

jobs:
  add-to-project:
    name: Add issue to project board
    runs-on: ubuntu-latest
    permissions:
      issues: write
      contents: read
    steps:
      - name: Add to project
        uses: actions/add-to-project@v0.5.0
        with:
          # Replace with your actual project URL
          # Find it at: https://github.com/orgs/SecPal/projects/YOUR_PROJECT_NUMBER
          project-url: https://github.com/orgs/SecPal/projects/1
          github-token: ${{ secrets.GITHUB_TOKEN }}

  set-status-field:
    name: Set initial status based on labels
    runs-on: ubuntu-latest
    needs: add-to-project
    if: contains(github.event.issue.labels.*.name, 'enhancement') || contains(github.event.issue.labels.*.name, 'core-feature')
    steps:
      - name: Determine initial status
        id: status
        run: |
          # Check labels to determine initial project status
          CORE_FEATURE="${{ contains(github.event.issue.labels.*.name, 'core-feature') }}"
          BLOCKER="${{ contains(github.event.issue.labels.*.name, 'priority: blocker') }}"

          if [[ "$CORE_FEATURE" == "true" ]]; then
            echo "status=ðŸ“‹ Backlog" >> "$GITHUB_OUTPUT"
          elif [[ "$BLOCKER" == "true" ]]; then
            echo "status=ðŸŽ¯ Ready" >> "$GITHUB_OUTPUT"
          else
            echo "status=ðŸ’¡ Ideas" >> "$GITHUB_OUTPUT"
          fi

      - name: Comment on issue
        uses: actions/github-script@v7
        with:
          script: |
            const status = '${{ steps.status.outputs.status }}';
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: `âœ… This issue has been automatically added to the [SecPal Feature Roadmap](https://github.com/orgs/SecPal/projects/1) with status: **${status}**\n\nNext steps:\n- Review and refine the issue description\n- Add relevant labels (area, priority)\n- Link related issues/PRs\n- Move to appropriate project column as needed`
            });
